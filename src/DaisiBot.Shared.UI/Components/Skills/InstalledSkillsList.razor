@inject ISkillService SkillService

<MudText Typo="Typo.h6" Class="mb-4">Installed Skills</MudText>

@if (_loading)
{
    <MudProgressLinear Indeterminate="true" Color="Color.Primary" />
}
else if (_skills.Count == 0)
{
    <MudAlert Severity="Severity.Info">
        No skills installed yet. Browse the skill marketplace to discover and install skills.
    </MudAlert>
}
else
{
    <MudList T="string">
        @foreach (var installed in _skills)
        {
            <MudListItem>
                <div class="d-flex align-center">
                    <MudIcon Icon="@Icons.Material.Filled.Extension" Class="mr-3" />
                    <div class="flex-grow-1">
                        <MudText Typo="Typo.body1">@installed.SkillId</MudText>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">
                            Installed @installed.EnabledAt.ToLocalTime().ToString("MMM d, yyyy")
                        </MudText>
                    </div>
                    <MudButton Variant="Variant.Outlined" Color="Color.Error" Size="Size.Small"
                               OnClick="@(() => UninstallAsync(installed.SkillId))">
                        Uninstall
                    </MudButton>
                </div>
            </MudListItem>
        }
    </MudList>
}

@code {
    [Parameter, EditorRequired] public string AccountId { get; set; } = string.Empty;

    private List<InstalledSkill> _skills = [];
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadAsync();
    }

    private async Task LoadAsync()
    {
        _loading = true;
        _skills = await SkillService.GetInstalledSkillsAsync(AccountId);
        _loading = false;
    }

    private async Task UninstallAsync(string skillId)
    {
        await SkillService.UninstallSkillAsync(AccountId, skillId);
        await LoadAsync();
    }
}
