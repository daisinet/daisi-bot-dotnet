@page "/learn/configuration"
@layout DaisiBot.Web.Components.Pages.Learn.LearnLayout

<h1 class="font-accent mb-4">Module 3 &middot; <span class="text-accent">Configuration &amp; Host Mode</span></h1>

<div class="glass-card mb-4">
    <h4 class="font-accent">User Settings Overview</h4>
    <p>
        All configuration lives in a single <code>UserSettings</code> row (ID&nbsp;=&nbsp;1) in the
        local SQLite database. You change settings through the Settings dialog
        (F4 in TUI, gear icon in MAUI) or programmatically via <code>ISettingsService</code>.
    </p>
    <p class="mb-0">Here are the key settings groups:</p>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">Inference Settings</h4>
    <table class="table table-dark table-bordered">
        <thead>
            <tr><th style="width:30%;">Setting</th><th>Purpose</th><th style="width:20%;">Default</th></tr>
        </thead>
        <tbody>
            <tr><td class="text-accent">DefaultModelName</td><td>Which model to use for new conversations</td><td>First available</td></tr>
            <tr><td class="text-accent">DefaultThinkLevel</td><td>Reasoning depth for new conversations</td><td>Basic</td></tr>
            <tr><td class="text-accent">Temperature</td><td>Randomness of responses (0.0 &ndash; 2.0)</td><td>0.7</td></tr>
            <tr><td class="text-accent">TopP</td><td>Nucleus sampling threshold</td><td>0.9</td></tr>
            <tr><td class="text-accent">MaxTokens</td><td>Maximum response length in tokens</td><td>2048</td></tr>
            <tr><td class="text-accent">SystemPrompt</td><td>Default persona / instructions injected into every conversation</td><td>(empty)</td></tr>
        </tbody>
    </table>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">Host Mode Settings</h4>
    <p>These only apply when <strong>HostModeEnabled</strong> is <code>true</code> (the default).</p>
    <table class="table table-dark table-bordered">
        <thead>
            <tr><th style="width:30%;">Setting</th><th>Purpose</th><th style="width:20%;">Default</th></tr>
        </thead>
        <tbody>
            <tr><td class="text-accent">HostModeEnabled</td><td>Run inference locally instead of routing to DaisiNet</td><td>true</td></tr>
            <tr><td class="text-accent">ModelFolderPath</td><td>Where GGUF model files are stored</td><td>Auto-detected</td></tr>
            <tr><td class="text-accent">LlamaRuntime</td><td>Backend: CPU, CUDA, or Vulkan</td><td>Auto</td></tr>
            <tr><td class="text-accent">ContextSize</td><td>Token context window for local models</td><td>2048</td></tr>
            <tr><td class="text-accent">GpuLayerCount</td><td>Layers offloaded to GPU (-1 = auto-detect)</td><td>-1</td></tr>
            <tr><td class="text-accent">BatchSize</td><td>Inference batch size</td><td>512</td></tr>
            <tr><td class="text-accent">NetworkHostEnabled</td><td>Serve your idle cycles to the DAISI network</td><td>false</td></tr>
        </tbody>
    </table>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">Network Settings</h4>
    <table class="table table-dark table-bordered">
        <thead>
            <tr><th style="width:30%;">Setting</th><th>Purpose</th><th style="width:20%;">Default</th></tr>
        </thead>
        <tbody>
            <tr><td class="text-accent">OrcDomain</td><td>Hostname of the orchestrator to connect to</td><td>Public ORC</td></tr>
            <tr><td class="text-accent">OrcPort</td><td>gRPC port</td><td>443</td></tr>
            <tr><td class="text-accent">OrcUseSsl</td><td>Enable TLS for the gRPC connection</td><td>true</td></tr>
            <tr><td class="text-accent">NetworkName</td><td>Named network partition to join</td><td>(default)</td></tr>
        </tbody>
    </table>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">Host Mode Deep Dive</h4>
    <p>When Host Mode is enabled, the startup flow is:</p>
    <ol>
        <li><strong>Query the ORC</strong> for the list of required model files.</li>
        <li><strong>Scan local folder</strong> and compare with the required list.</li>
        <li><strong>Download missing models</strong> &mdash; a progress dialog appears (text bar in TUI, linear progress in MAUI).</li>
        <li><strong>Initialize LLamaSharp</strong> with the selected backend (CPU / CUDA / Vulkan).</li>
        <li><strong>Ready</strong> &mdash; inference happens entirely on your hardware.</li>
    </ol>
    <p class="mb-0">
        You can toggle Host Mode at any time via the <strong>HostModeToggle</strong> component.
        Switching to DaisiNet mode skips local model loading and routes all requests through
        the orchestrator instead.
    </p>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">Tool Groups</h4>
    <p>
        Tool Groups control which <em>capabilities</em> the agent can use in a conversation.
        Think of them as permission sets for the agent's "hands." Each group is classified
        as either <span class="badge badge-standard">Standard</span> (lower risk) or
        <span class="badge badge-elevated">Elevated</span> (higher risk &mdash; requires
        explicit confirmation when enabled).
    </p>
    <p>
        Enable or disable these per-conversation in Settings (F4 in TUI, gear icon in MAUI).
        Skills can also declare which tool groups they require &mdash; when you install a
        skill, its required groups are shown with their permission level.
    </p>
</div>

<h5 class="font-accent mb-3"><span class="badge badge-standard me-2">Standard</span> Tool Groups</h5>
<p class="text-muted">These groups are lower risk. They read data, perform calculations, or generate content without direct system-level side effects.</p>

<div class="glass-card mb-3" style="border-color: rgba(76,175,80,0.3);">
    <div class="d-flex align-items-start gap-3">
        <span class="badge badge-standard px-3 py-2 fs-6 text-nowrap">Standard</span>
        <div>
            <h5 class="font-accent text-accent mb-1">InformationTools</h5>
            <p class="text-muted mb-2">Search the web, look up facts, and retrieve public information.</p>
            <p class="mb-0"><strong>Typical use cases:</strong> answering factual questions, summarizing web pages, looking up documentation, real-time data retrieval (weather, stock prices, news).</p>
        </div>
    </div>
</div>

<div class="glass-card mb-3" style="border-color: rgba(76,175,80,0.3);">
    <div class="d-flex align-items-start gap-3">
        <span class="badge badge-standard px-3 py-2 fs-6 text-nowrap">Standard</span>
        <div>
            <h5 class="font-accent text-accent mb-1">MathTools</h5>
            <p class="text-muted mb-2">Perform calculations, solve equations, and process numerical data.</p>
            <p class="mb-0"><strong>Typical use cases:</strong> arithmetic, unit conversions, statistical analysis, plotting data, solving algebra or calculus problems step by step.</p>
        </div>
    </div>
</div>

<div class="glass-card mb-3" style="border-color: rgba(76,175,80,0.3);">
    <div class="d-flex align-items-start gap-3">
        <span class="badge badge-standard px-3 py-2 fs-6 text-nowrap">Standard</span>
        <div>
            <h5 class="font-accent text-accent mb-1">CodingTools</h5>
            <p class="text-muted mb-2">Write, analyze, and debug code snippets.</p>
            <p class="mb-0"><strong>Typical use cases:</strong> generating code in any language, explaining existing code, finding bugs, refactoring suggestions, writing unit tests. Note: this does <em>not</em> grant filesystem access &mdash; the agent works with code in-memory. To save files, <strong>FileTools</strong> must also be enabled.</p>
        </div>
    </div>
</div>

<div class="glass-card mb-3" style="border-color: rgba(76,175,80,0.3);">
    <div class="d-flex align-items-start gap-3">
        <span class="badge badge-standard px-3 py-2 fs-6 text-nowrap">Standard</span>
        <div>
            <h5 class="font-accent text-accent mb-1">MediaTools</h5>
            <p class="text-muted mb-2">Generate, edit, and process images, audio, and video.</p>
            <p class="mb-0"><strong>Typical use cases:</strong> image generation from prompts, resizing and cropping, audio transcription, thumbnail creation. Output is returned in the conversation; saving to disk requires <strong>FileTools</strong>.</p>
        </div>
    </div>
</div>

<div class="glass-card mb-4" style="border-color: rgba(76,175,80,0.3);">
    <div class="d-flex align-items-start gap-3">
        <span class="badge badge-standard px-3 py-2 fs-6 text-nowrap">Standard</span>
        <div>
            <h5 class="font-accent text-accent mb-1">SocialTools</h5>
            <p class="text-muted mb-2">Interact with social platforms and public APIs.</p>
            <p class="mb-0"><strong>Typical use cases:</strong> reading public posts and profiles, summarizing social threads, monitoring hashtags or trends, querying public REST APIs.</p>
        </div>
    </div>
</div>

<h5 class="font-accent mb-3"><span class="badge badge-elevated me-2">Elevated</span> Tool Groups</h5>
<p class="text-muted">These groups carry higher risk because they can modify your filesystem, send messages on your behalf, or use your credentials to reach external services. DaisiBot shows a confirmation dialog when you enable them.</p>

<div class="glass-card mb-3" style="border-color: rgba(255,152,0,0.4);">
    <div class="d-flex align-items-start gap-3">
        <span class="badge badge-elevated px-3 py-2 fs-6 text-nowrap">Elevated</span>
        <div>
            <h5 class="font-accent text-accent mb-1">FileTools</h5>
            <p class="text-muted mb-2">Read, write, and manage files on your local system. This grants access to your filesystem.</p>
            <p class="mb-0"><strong>Typical use cases:</strong> creating and editing documents, reading CSVs or logs, organizing folders, saving generated code to disk. <strong>Risk:</strong> the agent can read sensitive files and overwrite existing ones. Limit use to conversations that genuinely need file access.</p>
        </div>
    </div>
</div>

<div class="glass-card mb-3" style="border-color: rgba(255,152,0,0.4);">
    <div class="d-flex align-items-start gap-3">
        <span class="badge badge-elevated px-3 py-2 fs-6 text-nowrap">Elevated</span>
        <div>
            <h5 class="font-accent text-accent mb-1">CommunicationTools</h5>
            <p class="text-muted mb-2">Send emails, messages, and notifications on your behalf.</p>
            <p class="mb-0"><strong>Typical use cases:</strong> drafting and sending emails, posting messages to team channels, scheduling reminders, sending SMS notifications. <strong>Risk:</strong> the agent acts <em>as you</em> &mdash; recipients will see messages from your account. Always review what the agent intends to send.</p>
        </div>
    </div>
</div>

<div class="glass-card mb-4" style="border-color: rgba(255,152,0,0.4);">
    <div class="d-flex align-items-start gap-3">
        <span class="badge badge-elevated px-3 py-2 fs-6 text-nowrap">Elevated</span>
        <div>
            <h5 class="font-accent text-accent mb-1">IntegrationTools</h5>
            <p class="text-muted mb-2">Connect to third-party services and APIs with your credentials.</p>
            <p class="mb-0"><strong>Typical use cases:</strong> creating Jira tickets, pushing to GitHub, querying databases, calling internal REST endpoints, updating spreadsheets in cloud services. <strong>Risk:</strong> the agent uses your stored credentials, so a misconfigured skill could take actions on external systems under your identity.</p>
        </div>
    </div>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">How Tool Groups Are Enforced</h4>
    <p>The <code>ToolPermissions</code> class in <code>DaisiBot.Core.Security</code> is the single source of truth. It maps every <code>ToolGroupSelection</code> enum value to a permission level and description. The UI component <code>ToolGroupSelector</code> reads this mapping to render checkboxes and automatically shows a confirmation dialog when you toggle an Elevated group.</p>
    <table class="table table-dark table-bordered mb-0">
        <thead>
            <tr><th>Group</th><th>Permission Level</th></tr>
        </thead>
        <tbody>
            <tr><td>InformationTools</td><td><span class="badge badge-standard">Standard</span></td></tr>
            <tr><td>MathTools</td><td><span class="badge badge-standard">Standard</span></td></tr>
            <tr><td>CodingTools</td><td><span class="badge badge-standard">Standard</span></td></tr>
            <tr><td>MediaTools</td><td><span class="badge badge-standard">Standard</span></td></tr>
            <tr><td>SocialTools</td><td><span class="badge badge-standard">Standard</span></td></tr>
            <tr><td>FileTools</td><td><span class="badge badge-elevated">Elevated</span></td></tr>
            <tr><td>CommunicationTools</td><td><span class="badge badge-elevated">Elevated</span></td></tr>
            <tr><td>IntegrationTools</td><td><span class="badge badge-elevated">Elevated</span></td></tr>
        </tbody>
    </table>
</div>

<div class="glass-card recall-checkpoint">
    <h4 class="font-accent">Active Recall Checkpoint</h4>
    <p>Cover the answers and test yourself before peeking.</p>

    <div class="recall-question">
        <p><strong>1.</strong> Where are all user settings stored?</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">In a single UserSettings row (ID = 1) in the local SQLite database.</p>
        </details>
    </div>

    <div class="recall-question">
        <p><strong>2.</strong> What are the three LLamaSharp backends DaisiBot can use for local inference?</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">CPU, CUDA, and Vulkan.</p>
        </details>
    </div>

    <div class="recall-question">
        <p><strong>3.</strong> What does <code>GpuLayerCount = -1</code> mean?</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">Auto-detect &mdash; DaisiBot will automatically decide how many model layers to offload to the GPU.</p>
        </details>
    </div>

    <div class="recall-question">
        <p><strong>4.</strong> Which three tool groups are classified as Elevated, and why?</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">FileTools (reads/writes your filesystem), CommunicationTools (sends messages as you), and IntegrationTools (uses your credentials to reach third-party services). They are Elevated because they can take actions with real-world side effects under your identity.</p>
        </details>
    </div>

    <div class="recall-question">
        <p><strong>5.</strong> CodingTools is Standard, yet it involves code. Why isn't it Elevated?</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">CodingTools works with code in-memory only &mdash; it can write, analyze, and debug code snippets but cannot save files to disk or execute them. Filesystem access requires the separate FileTools group.</p>
        </details>
    </div>

    <div class="recall-question">
        <p><strong>6.</strong> What happens in the UI when you try to enable an Elevated tool group?</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">The ToolGroupSelector shows a confirmation dialog describing the elevated access and asking you to Allow or Deny before it is enabled.</p>
        </details>
    </div>
</div>

<div class="d-flex justify-content-between mt-4">
    <a href="/learn/installation" class="btn btn-outline-light">&larr; Module 2</a>
    <a href="/learn/conversations" class="btn btn-accent">Module 4: Conversations &rarr;</a>
</div>
