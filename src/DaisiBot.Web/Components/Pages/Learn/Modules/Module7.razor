@page "/learn/security"
@layout DaisiBot.Web.Components.Pages.Learn.LearnLayout

<h1 class="font-accent mb-4">Module 7 &middot; <span class="text-accent">Security Best Practices</span></h1>

<div class="glass-card mb-4" style="border-color: rgba(252,4,0,0.4);">
    <h4 class="font-accent" style="color: var(--accent-color-red);">Why This Module Matters</h4>
    <p class="mb-0">
        DaisiBot can run commands, access files, and interact with external services through
        tool groups. That power comes with responsibility. A misconfigured agent or a
        malicious skill can cause real damage. This module covers every layer of defense.
    </p>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">1. Authentication</h4>
    <p>DaisiBot uses a <strong>two-step OTP (one-time password)</strong> flow:</p>
    <ol>
        <li><strong>Request</strong> &ndash; Enter your email or phone number. The system sends a verification code.</li>
        <li><strong>Verify</strong> &ndash; Enter the code. On success, DaisiBot receives a <code>ClientKey</code> (token) that is persisted in SQLite.</li>
    </ol>
    <p>
        The <code>AuthState</code> tracks: ClientKey, KeyExpiration, UserName, AccountName,
        AccountId, and UserEmail. An <code>IsAuthenticated</code> computed property checks
        that the key exists and hasn't expired.
    </p>
    <p class="mb-0"><strong>Best practices:</strong></p>
    <ul class="mb-0">
        <li>Never share your ClientKey or paste it into a chat.</li>
        <li>Log out when using shared machines (the token persists in the SQLite database).</li>
        <li>If you suspect your key is compromised, re-authenticate to rotate it.</li>
    </ul>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">2. Tool Group Permissions</h4>
    <p>
        Tool groups are the primary access-control mechanism for agent capabilities.
        DaisiBot distinguishes between <strong>Standard</strong> and <strong>Elevated</strong>
        groups via the <code>ToolPermissions</code> class.
    </p>
    <div class="row g-3 mt-2">
        <div class="col-md-6">
            <div class="glass-card h-100" style="border-color: rgba(76,175,80,0.4);">
                <h6 style="color: #4caf50;">Standard Groups</h6>
                <p class="text-muted mb-0">
                    Lower risk. Examples: Information, Math, Communication.
                    These read data or perform calculations without system-level side effects.
                </p>
            </div>
        </div>
        <div class="col-md-6">
            <div class="glass-card h-100" style="border-color: rgba(255,152,0,0.4);">
                <h6 style="color: #ff9800;">Elevated Groups</h6>
                <p class="text-muted mb-0">
                    Higher risk. Examples: File, Coding, Integration, Media.
                    These can modify your filesystem, run code, or call external APIs.
                </p>
            </div>
        </div>
    </div>
    <p class="mt-3 mb-0"><strong>Best practices:</strong></p>
    <ul class="mb-0">
        <li>Only enable tool groups a conversation or bot actually needs.</li>
        <li>Default new conversations to <strong>Basic</strong> think level (no tools) until you need them.</li>
        <li>Review elevated group usage regularly, especially for long-running bots.</li>
    </ul>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">3. Skill Review &amp; Trust</h4>
    <p>
        Skills inject system prompts that can influence everything the agent does.
        Treat them like third-party code.
    </p>
    <ul>
        <li>
            <strong>Review before installing</strong> &ndash; Read the skill's description,
            required tool groups, and (when possible) the system prompt template. If a
            "productivity" skill requests the Coding and File tool groups, ask why.
        </li>
        <li>
            <strong>Trust the review pipeline</strong> &ndash; Only <strong>Approved</strong>
            skills appear in the public marketplace. But approval is a filter, not a guarantee.
        </li>
        <li>
            <strong>Prefer minimal permissions</strong> &ndash; If two skills do similar things
            but one requires fewer tool groups, choose the simpler one.
        </li>
        <li>
            <strong>Audit your installed skills</strong> &ndash; Periodically check
            <a href="/installed">/installed</a> and remove skills you no longer use.
        </li>
    </ul>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">4. Protecting Keys &amp; Secrets</h4>
    <ul class="mb-0">
        <li>The SQLite database contains your <strong>ClientKey</strong> and settings. Treat the database file like a password store.</li>
        <li>Never commit the database file to version control.</li>
        <li>If you run DaisiBot.Web in production, ensure the Cosmos DB connection string and cookie encryption keys are stored in a secrets manager (not in <code>appsettings.json</code>).</li>
        <li>ORC connection settings include the domain and port &mdash; in a private network, keep these internal.</li>
    </ul>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">5. Network Security</h4>
    <ul class="mb-0">
        <li><strong>Always use TLS</strong> &ndash; Keep <code>OrcUseSsl = true</code> for all gRPC connections to the orchestrator.</li>
        <li><strong>Host mode exposure</strong> &ndash; If you enable <code>NetworkHostEnabled</code> to serve inference to others, understand that your machine will process prompts from other users on the network. This does not expose your filesystem, but it uses your compute.</li>
        <li><strong>Firewall the gateway</strong> &ndash; Never expose the local inference endpoint directly to the public internet. Let the ORC handle routing.</li>
    </ul>
</div>

<div class="glass-card mb-4">
    <h4 class="font-accent">Security Checklist</h4>
    <table class="table table-dark table-bordered">
        <tbody>
            <tr><td style="width:40px;" class="text-center">&#9744;</td><td>Only enable tool groups you need per-conversation</td></tr>
            <tr><td class="text-center">&#9744;</td><td>Review every skill's required permissions before installing</td></tr>
            <tr><td class="text-center">&#9744;</td><td>Protect your SQLite database file (it contains your auth token)</td></tr>
            <tr><td class="text-center">&#9744;</td><td>Keep OrcUseSsl = true for all network connections</td></tr>
            <tr><td class="text-center">&#9744;</td><td>Store production secrets in a secrets manager, not config files</td></tr>
            <tr><td class="text-center">&#9744;</td><td>Periodically audit and remove unused installed skills</td></tr>
            <tr><td class="text-center">&#9744;</td><td>Never expose local inference endpoints to the public internet</td></tr>
            <tr><td class="text-center">&#9744;</td><td>Log out on shared machines</td></tr>
        </tbody>
    </table>
</div>

<div class="glass-card recall-checkpoint">
    <h4 class="font-accent">Active Recall Checkpoint</h4>
    <p>Cover the answers and test yourself before peeking.</p>

    <div class="recall-question">
        <p><strong>1.</strong> Describe the two steps of DaisiBot's OTP authentication flow.</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">1) Request: enter email/phone, receive a verification code. 2) Verify: enter the code, receive a ClientKey token that is persisted in SQLite.</p>
        </details>
    </div>

    <div class="recall-question">
        <p><strong>2.</strong> What is the difference between Standard and Elevated tool groups?</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">Standard groups (Information, Math, Communication) are lower risk and mostly read-only. Elevated groups (File, Coding, Integration, Media) can modify the filesystem, execute code, or call external services.</p>
        </details>
    </div>

    <div class="recall-question">
        <p><strong>3.</strong> Why should you review a skill's required tool groups before installing it?</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">Skills inject system prompts that influence agent behavior. If a skill requests elevated tool groups it doesn't obviously need, it could be attempting to gain unnecessary access to your system.</p>
        </details>
    </div>

    <div class="recall-question">
        <p><strong>4.</strong> What happens when you enable NetworkHostEnabled?</p>
        <details><summary class="text-accent">Reveal answer</summary>
            <p class="mt-2">Your machine starts serving inference requests from other users on the DAISI network. This uses your compute resources but does not expose your filesystem.</p>
        </details>
    </div>
</div>

<div class="d-flex justify-content-between mt-4">
    <a href="/learn/bots" class="btn btn-outline-light">&larr; Module 6</a>
    <a href="/learn/next-steps" class="btn btn-accent">Module 8: Next Steps &rarr;</a>
</div>
